<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Pharmacist Dashboard</title>
  <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>
<body>

<div class="pane">
  <h1>Pharmacist Prescription List</h1>

  <div class="search-bar">
    <input type="text" id="search" placeholder="Search by patient name" oninput="searchPrescriptions()" />
  </div>

  <table id="prescriptionTable">
    <thead>
    <tr>
      <th>ID</th>
      <th>Patient</th>
      <th>Medication</th>
      <th>Issue Date</th>
      <th>Refills Remaining</th>
      <th>Refillable</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="prescription : ${prescriptions}">
      <td th:text="${prescription.id}"></td>
      <td th:text="${prescription.patient.name}"></td>
      <td th:text="${prescription.medication.name}"></td>
      <td th:text="${prescription.issueDate}"></td>
      <td th:text="${prescription.refillsRemaining}"></td>
      <td th:text="${prescription.refillable ? 'Yes' : 'No'}"></td>

      <!-- Display Status -->
      <td th:text="${prescription.dispensed
                      ? (prescription.refillsRemaining > 0 ? 'Partially Dispensed' : 'Fully Dispensed')
                      : 'Not Dispensed'}">
      </td>

      <!-- Action Buttons -->
      <td>
        <form th:action="@{/pharmacist/dispense/{id}(id=${prescription.id})}" method="post"
              th:if="${prescription.refillable and prescription.refillsRemaining > 0}">
          <button type="submit">Dispense</button>
        </form>
        <a th:href="@{/pharmacist/generic-substitutes/{id}(id=${prescription.medication.id})}">
          View Substitutes
        </a>
      </td>
    </tr>
    </tbody>
  </table>

  <div class="actions">
    <button class="action-btn" onclick="location.href='/login'">Logout</button>
  </div>
</div>

<script>
    function searchPrescriptions() {
      const input = document.getElementById('search').value.toLowerCase();
      const rows = document.querySelectorAll('#prescriptionTable tbody tr');

      rows.forEach(row => {
        const patientName = row.cells[1].textContent.toLowerCase();
        row.style.display = patientName.includes(input) ? '' : 'none';
      });
    }
</script>

</body>
</html>
